<div class="week-header">
  <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24">
    <!-- Icon from Myna UI Icons by Praveen Juge - https://github.com/praveenjuge/mynaui-icons/blob/main/LICENSE -->
    <path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
      d="M16.5 5V3m-9 2V3M3.25 8h17.5M3 10.044c0-2.115 0-3.173.436-3.981a3.9 3.9 0 0 1 1.748-1.651C6.04 4 7.16 4 9.4 4h5.2c2.24 0 3.36 0 4.216.412c.753.362 1.364.94 1.748 1.65c.436.81.436 1.868.436 3.983v4.912c0 2.115 0 3.173-.436 3.981a3.9 3.9 0 0 1-1.748 1.651C17.96 21 16.84 21 14.6 21H9.4c-2.24 0-3.36 0-4.216-.412a3.9 3.9 0 0 1-1.748-1.65C3 18.128 3 17.07 3 14.955z" />
  </svg>
  <h3>
    Week of {{ currentWeek[0] | date : "MMMM d" }} -
    {{ currentWeek[6] | date : "MMMM d" }}
  </h3>
</div>

<div class="week-grid">
  <table>
    <thead>
      <tr>
        <th [width]="130"></th>
        @for(member of familyMembers; track member; let idx = $index) {

        <th>
          <img src="images/family/avatar_{{ idx }}.png" alt="{{ member }}" />
          <div>
            {{ member }}
          </div>
        </th>
        }
      </tr>
    </thead>
    <tbody>
      @for(date of currentWeek; track date) {
      <tr>
        <td>
          <div class="day-name">{{ date | date : "EEEE" }}</div>
          <div class="day-number">
            {{ date | date : "d"
            }}<span class="suffix">{{ getDatesSuffix(date) }}</span>
          </div>
        </td>
        @for(member of familyMembers; track member) {
        <td [ngClass]="{ expired: date.getDate() < today.getDate() }" (click)="onCellClick(date, member, $event)">
          <div class="events-container">
            <div class="all-day-events">
              @for(event of getEventsForDateAndParticipantIncludingMultiDay(date, member); track event.id) {
                @if(event.isAllDay) {
                  <div class="event-wrapper" 
                       [style.margin-left.px]="isMultiDayEvent(event) ? getEventColumn(event, member) * 24 : 0"
                       [attr.data-event-id]="event.id">
                    <div class="event-item all-day" [ngClass]="{ 'multi-day': isMultiDayEvent(event) }" (click)="onEventClick(event)">
                      <div class="event-content">
                        <div class="event-title">{{ event.title }}</div>
                        <div class="event-time">
                          @if(isMultiDayEvent(event)) {
                            Day {{ getEventDayNumber(event, date).dayNumber }} of {{ getEventDayNumber(event, date).totalDays }}
                          } @else {
                            {{ formatEventTime(event) }}
                          }
                        </div>
                      </div>
                      @if(getOtherParticipants(event, member).length > 0) {
                        <div class="event-participants">
                          @for(participant of getOtherParticipants(event, member); track participant) {
                            <img 
                              src="images/family/avatar_{{ getFamilyMemberAvatarIndex(participant) }}.png" 
                              alt="{{ participant }}"
                              class="participant-avatar"
                              title="{{ participant }}"
                            />
                          }
                        </div>
                      }
                    </div>
                  </div>
                }
              }
            </div>
            <div class="timed-events">
              @for(event of getEventsForDateAndParticipantIncludingMultiDay(date, member); track event.id) {
                @if(!event.isAllDay) {
                  <div class="event-wrapper" 
                       [style.margin-left.px]="isMultiDayEvent(event) ? getEventColumn(event, member) * 24 : 0"
                       [attr.data-event-id]="event.id">
                    <div class="event-item timed" [ngClass]="{ 'multi-day': isMultiDayEvent(event) }" (click)="onEventClick(event)">
                      <div class="event-content">
                        <div class="event-title">{{ event.title }}</div>
                        <div class="event-time">
                          @if(isMultiDayEvent(event)) {
                            Day {{ getEventDayNumber(event, date).dayNumber }} of {{ getEventDayNumber(event, date).totalDays }}
                          } @else {
                            {{ formatEventTime(event) }}
                          }
                        </div>
                      </div>
                      @if(getOtherParticipants(event, member).length > 0) {
                        <div class="event-participants">
                          @for(participant of getOtherParticipants(event, member); track participant) {
                            <img 
                              src="images/family/avatar_{{ getFamilyMemberAvatarIndex(participant) }}.png" 
                              alt="{{ participant }}"
                              class="participant-avatar"
                              title="{{ participant }}"
                            />
                          }
                        </div>
                      }
                    </div>
                  </div>
                }
              }
            </div>
          </div>
        </td>
        }
      </tr>
      }
    </tbody>
  </table>
</div>